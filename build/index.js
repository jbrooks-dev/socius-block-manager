(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);const a=window.React,t=window.wp.element,s=window.wp.i18n,l=window.wp.components,c=window.wp.primitives,n=(0,a.createElement)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(c.Path,{d:"M19 8h-1V6h-5v2h-2V6H6v2H5c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm.5 10c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5v-8c0-.3.2-.5.5-.5h14c.3 0 .5.2.5.5v8z"})),o=(0,a.createElement)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(c.Path,{fillRule:"evenodd",d:"M10.289 4.836A1 1 0 0111.275 4h1.306a1 1 0 01.987.836l.244 1.466c.787.26 1.503.679 2.108 1.218l1.393-.522a1 1 0 011.216.437l.653 1.13a1 1 0 01-.23 1.273l-1.148.944a6.025 6.025 0 010 2.435l1.149.946a1 1 0 01.23 1.272l-.653 1.13a1 1 0 01-1.216.437l-1.394-.522c-.605.54-1.32.958-2.108 1.218l-.244 1.466a1 1 0 01-.987.836h-1.306a1 1 0 01-.986-.836l-.244-1.466a5.995 5.995 0 01-2.108-1.218l-1.394.522a1 1 0 01-1.217-.436l-.653-1.131a1 1 0 01.23-1.272l1.149-.946a6.026 6.026 0 010-2.435l-1.148-.944a1 1 0 01-.23-1.272l.653-1.131a1 1 0 011.217-.437l1.393.522a5.994 5.994 0 012.108-1.218l.244-1.466zM14.929 12a3 3 0 11-6 0 3 3 0 016 0z",clipRule:"evenodd"})),r=()=>{const{canManageRestrictions:t,userRole:c}=window.sociusBlockManager||{},r=[{icon:n,title:(0,s.__)("Block Management","socius-block-manager"),description:(0,s.__)("Control which Gutenberg blocks are available to different user roles.","socius-block-manager")},{icon:e.users,title:(0,s.__)("User Role Control","socius-block-manager"),description:(0,s.__)("Restrict blocks based on user roles: Subscriber, Contributor, Author, Editor, and Administrator.","socius-block-manager")},{icon:o,title:(0,s.__)("Variation Management","socius-block-manager"),description:(0,s.__)("Fine-tune access by controlling individual block variations.","socius-block-manager")}];return(0,a.createElement)("div",{className:"socius-splash-container"},(0,a.createElement)("div",{className:"socius-splash-header"},(0,a.createElement)("h1",null,(0,s.__)("Socius Block Manager","socius-block-manager")),(0,a.createElement)("p",{className:"socius-splash-tagline"},(0,s.__)("Manage Gutenberg block access with precision and control","socius-block-manager")),(0,a.createElement)("div",{className:"socius-user-info"},(0,a.createElement)("span",{className:`user-role-badge role-${c}`},(0,s.__)("Current Role:","socius-block-manager")," ",(0,a.createElement)("strong",null,c?.replace("_"," ").toUpperCase())))),(0,a.createElement)("div",{className:"socius-features-grid"},r.map((e,t)=>(0,a.createElement)(l.Card,{key:t,className:"socius-feature-card"},(0,a.createElement)(l.CardHeader,null,(0,a.createElement)("div",{className:"feature-icon"},e.icon),(0,a.createElement)("h3",null,e.title)),(0,a.createElement)(l.CardBody,null,(0,a.createElement)("p",null,e.description))))),(0,a.createElement)("div",{className:"socius-actions"},(0,a.createElement)(l.Card,{className:"socius-main-action-card"},(0,a.createElement)(l.CardBody,null,(0,a.createElement)("h2",null,(0,s.__)("Block Restrictions","socius-block-manager")),(0,a.createElement)("p",null,t?(0,s.__)("Manage which blocks and variations are available to different user roles.","socius-block-manager"):(0,s.__)("Only Super Admin users can manage block restrictions.","socius-block-manager")),t?(0,a.createElement)(l.Button,{isPrimary:!0,onClick:()=>{window.location.href="admin.php?page=socius-block-restrictions"},className:"socius-primary-button"},(0,s.__)("Manage Block Restrictions","socius-block-manager")):(0,a.createElement)("div",{className:"socius-access-denied"},(0,a.createElement)("p",{className:"access-message"},(0,s.__)("Contact your Super Admin to manage block restrictions.","socius-block-manager")))))),(0,a.createElement)("div",{className:"socius-footer"},(0,a.createElement)("div",{className:"socius-stats"},(0,a.createElement)("div",{className:"stat-item"},(0,a.createElement)("strong",null,(0,s.__)("Plugin Version:","socius-block-manager"))," ","1.0.0"),(0,a.createElement)("div",{className:"stat-item"},(0,a.createElement)("strong",null,(0,s.__)("Theme Blocks Directory:","socius-block-manager"))," ","/blocks/"))))},i=(window.wp.apiFetch,(0,a.createElement)(c.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)(c.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"}))),m=(0,a.createElement)(c.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)(c.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})),u=({block:e,restrictions:c,onUpdateRestriction:n})=>{const[o,r]=(0,t.useState)(!1),u=!1!==c.allowed,d=e.variations&&e.variations.length>0,g=e=>!1!==c.variations?.[e]?.allowed,b=()=>u?d&&e.variations.some(e=>!g(e.name))?"status-partial":"status-allowed":"status-restricted";return(0,a.createElement)(l.Card,{className:`socius-block-card ${b()}`},(0,a.createElement)(l.CardBody,null,(0,a.createElement)("div",{className:"block-header"},(0,a.createElement)("div",{className:"block-info"},(0,a.createElement)("h3",{className:"block-title"},e.title),(0,a.createElement)("div",{className:"block-meta"},(0,a.createElement)("span",{className:"block-name"},e.name),(0,a.createElement)("span",{className:"block-category"},e.category)),e.description&&(0,a.createElement)("p",{className:"block-description"},e.description)),(0,a.createElement)("div",{className:"block-status"},(0,a.createElement)("span",{className:`status-badge ${b()}`},(()=>{if(!u)return(0,s.__)("Restricted","socius-block-manager");if(d){const a=e.variations.filter(e=>!g(e.name));if(a.length>0)return`${a.length} ${(0,s.__)("variations restricted","socius-block-manager")}`}return(0,s.__)("Allowed","socius-block-manager")})()))),(0,a.createElement)("div",{className:"block-controls"},(0,a.createElement)(l.ToggleControl,{label:(0,s.__)("Allow this block","socius-block-manager"),checked:u,onChange:a=>n(e.name,a),help:u?(0,s.__)("Block is available to all users","socius-block-manager"):(0,s.__)("Block is restricted from non-Super Admin users","socius-block-manager")}),d&&(0,a.createElement)("div",{className:"variations-section"},(0,a.createElement)("button",{type:"button",className:"variations-toggle",onClick:()=>r(!o),disabled:!u},(0,a.createElement)("span",null,`${e.variations.length} ${(0,s.__)("variations","socius-block-manager")}`),(0,a.createElement)("span",{className:"toggle-icon"},o?i:m)),o&&u&&(0,a.createElement)("div",{className:"variations-list"},e.variations.map(t=>(0,a.createElement)("div",{key:t.name,className:"variation-item"},(0,a.createElement)(l.CheckboxControl,{label:t.title||t.name,checked:g(t.name),onChange:a=>n(e.name,a,t.name),help:t.description})))),o&&!u&&(0,a.createElement)("div",{className:"variations-disabled-notice"},(0,a.createElement)("p",null,(0,s.__)("Enable the block to manage individual variations","socius-block-manager"))))),(0,a.createElement)("div",{className:"block-footer"},(0,a.createElement)("div",{className:"block-directory"},(0,a.createElement)("small",null,(0,s.__)("Directory:","socius-block-manager")," ",(0,a.createElement)("code",null,"/blocks/",e.directory,"/"))))))},d=()=>{const[e,c]=(0,t.useState)([]),[n,o]=(0,t.useState)({}),[r,i]=(0,t.useState)(!0),[m,d]=(0,t.useState)(!1),[g,b]=(0,t.useState)(null),[k,E]=(0,t.useState)(""),[_,v]=(0,t.useState)("all"),[p,h]=(0,t.useState)(!1),{ajaxUrl:w,nonce:y}=window.sociusBlockManager||{};(0,t.useEffect)(()=>{N(),f()},[]);const N=async()=>{try{const e=new FormData;e.append("action","get_blocks"),e.append("nonce",y);const a=await fetch(w,{method:"POST",body:e}),t=await a.json();t.success?c(t.data):b({type:"error",message:(0,s.__)("Failed to load blocks","socius-block-manager")})}catch(e){b({type:"error",message:(0,s.__)("Error loading blocks","socius-block-manager")})}},f=async()=>{try{const e=new FormData;e.append("action","get_block_restrictions"),e.append("nonce",y);const a=await fetch(w,{method:"POST",body:e}),t=await a.json();t.success&&o(t.data||{})}catch(e){console.error("Error loading restrictions:",e)}finally{i(!1)}},C=(e,a,t=null)=>{o(s=>{const l={...s};return l[e]||(l[e]={allowed:!0,variations:{}}),t?l[e].variations[t]={allowed:a}:l[e].allowed=a,l})},S=a=>{const t={};e.forEach(e=>{t[e.name]={allowed:a,variations:{}},e.variations&&e.variations.length>0&&e.variations.forEach(s=>{t[e.name].variations[s.name]={allowed:a}})}),o(t)},B=e.filter(e=>{if(k&&!e.title.toLowerCase().includes(k.toLowerCase())&&!e.name.toLowerCase().includes(k.toLowerCase()))return!1;if("all"!==_&&e.category!==_)return!1;if(p){const a=n[e.name],t=a&&!a.allowed,s=a&&Object.values(a.variations||{}).some(e=>!e.allowed);if(!t&&!s)return!1}return!0});return r?(0,a.createElement)("div",{className:"socius-loading"},(0,a.createElement)(l.Spinner,null),(0,a.createElement)("p",null,(0,s.__)("Loading blocks...","socius-block-manager"))):(0,a.createElement)("div",{className:"socius-restrictions-container"},(0,a.createElement)("div",{className:"socius-restrictions-header"},(0,a.createElement)("h1",null,(0,s.__)("Block Restrictions","socius-block-manager")),(0,a.createElement)("p",null,(0,s.__)("Control which blocks and variations are available to non-Super Admin users. Unchecked items will be restricted.","socius-block-manager"))),g&&(0,a.createElement)(l.Notice,{status:g.type,onRemove:()=>b(null),isDismissible:!0},g.message),(0,a.createElement)(l.Card,{className:"socius-controls-card"},(0,a.createElement)(l.CardBody,null,(0,a.createElement)("div",{className:"socius-controls-grid"},(0,a.createElement)(l.SearchControl,{label:(0,s.__)("Search blocks","socius-block-manager"),value:k,onChange:E,placeholder:(0,s.__)("Search by block name or title...","socius-block-manager")}),(0,a.createElement)(l.SelectControl,{label:(0,s.__)("Filter by category","socius-block-manager"),value:_,onChange:v,options:[{label:(0,s.__)("All Categories","socius-block-manager"),value:"all"},...(()=>{const a=new Set(e.map(e=>e.category));return Array.from(a).sort()})().map(e=>({label:e.charAt(0).toUpperCase()+e.slice(1),value:e}))]}),(0,a.createElement)(l.ToggleControl,{label:(0,s.__)("Show only restricted","socius-block-manager"),checked:p,onChange:h,help:(0,s.__)("Display only blocks or variations that are currently restricted","socius-block-manager")})),(0,a.createElement)("div",{className:"socius-bulk-actions"},(0,a.createElement)("div",{className:"bulk-action-buttons"},(0,a.createElement)(l.Button,{isSecondary:!0,onClick:()=>S(!0)},(0,s.__)("Allow All Blocks","socius-block-manager")),(0,a.createElement)(l.Button,{isSecondary:!0,onClick:()=>S(!1)},(0,s.__)("Restrict All Blocks","socius-block-manager")))))),(0,a.createElement)("div",{className:"socius-blocks-grid"},0===B.length?(0,a.createElement)("div",{className:"socius-no-blocks"},(0,a.createElement)("p",null,(0,s.__)("No blocks found matching your criteria.","socius-block-manager"))):B.map(e=>(0,a.createElement)(u,{key:e.name,block:e,restrictions:n[e.name]||{allowed:!0,variations:{}},onUpdateRestriction:C}))),(0,a.createElement)("div",{className:"socius-save-section"},(0,a.createElement)(l.Card,null,(0,a.createElement)(l.CardBody,null,(0,a.createElement)("div",{className:"save-actions"},(0,a.createElement)(l.Button,{isPrimary:!0,onClick:async()=>{d(!0);try{const e=new FormData;e.append("action","save_block_restrictions"),e.append("nonce",y),e.append("restrictions",JSON.stringify(n));const a=await fetch(w,{method:"POST",body:e}),t=await a.json();t.success?b({type:"success",message:(0,s.__)("Block restrictions saved successfully!","socius-block-manager")}):b({type:"error",message:t.data||(0,s.__)("Failed to save restrictions","socius-block-manager")})}catch(e){b({type:"error",message:(0,s.__)("Error saving restrictions","socius-block-manager")})}finally{d(!1)}},isBusy:m,disabled:m},m?(0,s.__)("Saving...","socius-block-manager"):(0,s.__)("Save Restrictions","socius-block-manager")),(0,a.createElement)("div",{className:"save-info"},(0,a.createElement)("p",null,(0,s.__)("Found","socius-block-manager")," ",(0,a.createElement)("strong",null,e.length)," ",(0,s.__)("blocks in theme directory","socius-block-manager")),(0,a.createElement)("p",null,(0,s.__)("Displaying","socius-block-manager")," ",(0,a.createElement)("strong",null,B.length)," ",(0,s.__)("blocks","socius-block-manager"))))))))},g=()=>{const{currentPage:e,canManageRestrictions:t}=window.sociusBlockManager||{};return"socius-block-restrictions"===e?t?(0,a.createElement)(d,null):(0,a.createElement)("div",{className:"socius-error"},(0,a.createElement)("h2",null,(0,s.__)("Access Denied","socius-block-manager")),(0,a.createElement)("p",null,(0,s.__)("You do not have permission to manage block restrictions. Only Super Admin users can access this feature.","socius-block-manager"))):(0,a.createElement)(r,null)},b=document.getElementById("socius-block-manager-splash");b&&(0,t.render)((0,a.createElement)(g,null),b);const k=document.getElementById("socius-block-manager-restrictions");k&&(0,t.render)((0,a.createElement)(g,null),k)})();